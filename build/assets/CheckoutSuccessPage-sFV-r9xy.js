import{c as k,r as l,j as e,C as v,a as S,B as x,s as C}from"./index-CGfRSwDa.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],I=k("loader-circle",E),R="/dashboard/guestview",W=t=>`${R}/${encodeURIComponent(t)}`,q=()=>{if(typeof window>"u")return null;const s=new URLSearchParams(window.location.search).get("session_id");return s&&s.trim().length>0?s:null};function D(){const[t,s]=l.useState("idle"),[d,m]=l.useState(null),[o,h]=l.useState(null),r=l.useMemo(()=>q(),[]),u=o?.booking?.status?.toUpperCase()??null,i=u==="PENDING"||u==="REQUESTED",f=i?"Booking request sent":"Payment successful",p=i?"We sent your request to the host. We’ll email you as soon as they respond, and your payment won’t be captured until then.":"You’re all set! We sent a confirmation email with everything you need for your class.",g=i?"Request delivered to your host":"You’re officially booked!",y=i?"Your request details are saved in your dashboard so you can follow up or add information for the host.":"We saved the full details in your dashboard. Here’s a quick summary:",b=i?["We’ll email you as soon as the host approves or declines the request.","You can review or cancel the request anytime from your dashboard.","Your payment method will only be charged once the host approves."]:["We’ve emailed your booking confirmation and host contact information.","You can manage your reservation and messages from the dashboard.","If you have questions, reply to the confirmation email or reach out to HERD support."];l.useEffect(()=>{let a=!1;const N=async w=>{s("loading");try{const{data:n,error:c}=await C.functions.invoke("confirm-booking",{body:{sessionId:w}});if(a)return;if(c){m(c.message??"We could not confirm your booking."),s("error");return}n&&h(n),s("success")}catch(n){if(a)return;const c=n instanceof Error?n.message:String(n);m(c),s("error")}};if(!r){s("skipped");return}return N(r),()=>{a=!0}},[r]);const j=()=>{typeof window>"u"||(window.location.href=W("mybookings"))};return e.jsx("div",{className:"min-h-screen bg-[#f8f9f6]",children:e.jsxs("div",{className:"mx-auto flex max-w-3xl flex-col px-6 py-24 text-center",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-emerald-100",children:e.jsx(v,{className:"h-10 w-10 text-emerald-600","aria-hidden":"true"})}),e.jsx("h1",{className:"mt-8 text-3xl font-semibold text-neutral-900 sm:text-4xl",children:f}),e.jsx("p",{className:"mt-4 text-lg text-neutral-600",children:p}),t==="loading"&&e.jsxs("div",{className:"mt-8 flex items-center justify-center gap-3 text-neutral-600",children:[e.jsx(I,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Finalizing your booking…"})]}),t==="error"&&e.jsx("div",{className:"mt-8 rounded-lg border border-red-200 bg-red-50 px-6 py-4 text-left text-red-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(S,{className:"mt-0.5 h-5 w-5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"We ran into an issue while confirming your booking."}),d&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:d}),r&&e.jsxs("p",{className:"mt-2 text-sm text-red-600",children:["Session ID: ",e.jsx("span",{className:"font-mono",children:r})]}),e.jsx("p",{className:"mt-3 text-sm",children:"Your payment may have gone through—please check your dashboard or contact support if this continues."})]})]})}),t==="skipped"&&e.jsxs("div",{className:"mt-8 rounded-lg border border-amber-200 bg-amber-50 px-6 py-4 text-left text-amber-700",children:[e.jsx("p",{className:"font-medium",children:"We couldn't find a Stripe session in the URL."}),e.jsx("p",{className:"mt-2 text-sm",children:"If you completed a payment recently, you can still review your bookings from the dashboard."})]}),o?.booking&&t==="success"&&e.jsxs("div",{className:"mt-8 rounded-2xl border border-emerald-200 bg-white px-6 py-6 text-left shadow-sm",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-emerald-600",children:"Booking confirmed"}),e.jsx("h2",{className:"mt-2 text-xl font-semibold text-neutral-900",children:g}),e.jsx("p",{className:"mt-2 text-sm text-neutral-600",children:y}),e.jsxs("dl",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:[o.booking.status&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-medium uppercase tracking-wide text-neutral-500",children:"Status"}),e.jsx("dd",{className:"mt-1 text-base font-semibold text-emerald-600",children:o.booking.status})]}),o.session?.customer_email&&e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("dt",{className:"text-xs font-medium uppercase tracking-wide text-neutral-500",children:"Confirmation email"}),e.jsx("dd",{className:"mt-1 text-base text-neutral-800",children:o.session.customer_email})]})]})]}),e.jsxs("div",{className:"mt-10 flex flex-col items-center justify-center gap-3 sm:flex-row",children:[e.jsx(x,{size:"lg",onClick:j,children:"Go to my bookings"}),e.jsx(x,{variant:"outline",size:"lg",onClick:()=>{window.location.href="/"},children:"Return home"})]}),e.jsxs("div",{className:"mt-12 rounded-lg border border-neutral-200 bg-white px-6 py-5 text-left shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-neutral-900",children:"What happens next?"}),e.jsx("ul",{className:"mt-3 list-disc space-y-2 pl-5 text-sm text-neutral-600",children:b.map(a=>e.jsx("li",{children:a},a))})]})]})})}export{D as default};
